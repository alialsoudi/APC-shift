<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Shift Tracker - APC</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Kufi+Arabic:wght@400;700;800&display=swap" rel="stylesheet">

<style>
    :root { --main-font: 'Inter', 'Noto Kufi Arabic', sans-serif; }
    body { font-family: var(--main-font); background: #ffffff; -webkit-font-smoothing: antialiased; }

    .main-title {
        font-size: 26px;
        font-weight: 800;
        letter-spacing: -1px;
        color: #000;
        text-transform: uppercase;
        font-style: italic;
        line-height: 1;
    }

    .card { background: #ffffff; border-radius: 14px; border: 1px solid #e5e7eb; }
    .input-wrapper { position: relative; display: flex; align-items: center; }
    
    [dir="rtl"] .input-wrapper::after { left: 12px; right: auto; content: '▼'; font-size: 8px; position: absolute; color: #9ca3af; pointer-events: none; }
    [dir="ltr"] .input-wrapper::after { right: 12px; left: auto; content: '▼'; font-size: 8px; position: absolute; color: #9ca3af; pointer-events: none; }

    .control-input {
        width: 100%; border-radius: 12px; border: 1.5px solid #f3f4f6; background: #f9fafb;
        padding: 10px 12px; font-size: 12px; font-weight: 700; appearance: none; -webkit-appearance: none; outline: none;
        font-family: inherit;
    }

    .day-cell {
        aspect-ratio: 1/1; border-radius: 6px; padding: 4px 2px;
        display: flex; flex-direction: column; justify-content: space-between;
        align-items: center; font-weight: 600; text-align: center;
    }

    .day-number { font-size: 11px; font-weight: 700; color: #111827; }
    .shift-label { font-size: 8px; font-weight: 700; line-height: 1.1; text-transform: uppercase; }

    .shift-morning { background: #dcfce7; color: #166534; }
    .shift-afternoon { background: #dbeafe; color: #1e40af; }
    .shift-night { background: #fef3c7; color: #92400e; }
    .shift-off { background: #fde8e8; color: #b91c1c; }

    .control-label { font-size: 9px; font-weight: 800; color: #9ca3af; margin-bottom: 4px; display: block; text-transform: uppercase; }
    .company-name { font-size: 10px; font-weight: 700; color: #4b5563; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 2px; }

    .lang-btn {
        position: absolute; top: 20px; left: 20px;
        background: #f3f4f6; padding: 6px 12px; border-radius: 8px;
        font-size: 10px; font-weight: 800; cursor: pointer; border: 1px solid #e5e7eb;
    }
    [dir="ltr"] .lang-btn { left: auto; right: 20px; }

    #t-export-btn {
        font-family: 'Noto Kufi Arabic', sans-serif;
        letter-spacing: normal;
    }
</style>
</head>

<body class="antialiased">

<div class="max-w-md mx-auto px-5 py-8 flex flex-col min-h-screen relative">
    
    <button onclick="toggleLang()" class="lang-btn" id="langBtn">EN</button>

    <div class="mb-6">
        <div class="flex flex-col items-start border-r-4 [dir='ltr']:border-r-0 [dir='ltr']:border-l-4 border-black pr-4 [dir='ltr']:pl-4 py-1">
            <h1 class="main-title" id="t-title">متابع الشفتات</h1>
            <p class="company-name mt-1" id="t-company">شركة البوتاس العربية</p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-6">
        <div>
            <label class="control-label" id="t-select-shift">اختر الوردية</label>
            <div class="input-wrapper">
                <select id="shiftSelect" class="control-input">
                    <option value="A">الوردية A</option>
                    <option value="B">الوردية B</option>
                    <option value="C">الوردية C</option>
                    <option value="D">الوردية D</option>
                </select>
            </div>
        </div>

        <div>
            <label class="control-label" id="t-pick-month">اختر الشهر</label>
            <div class="input-wrapper">
                <input type="month" id="monthPicker" class="control-input">
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-6">
        <div id="calendarHeader" class="text-center py-3 font-bold text-sm border-b bg-gray-50/50 uppercase tracking-widest text-gray-700"></div>
        <div id="weekDaysRow" class="grid grid-cols-7 text-center text-[9px] font-black text-gray-400 py-2 border-b uppercase"></div>
        <div id="calendarGrid" class="grid grid-cols-7 gap-[3px] p-2"></div>
    </div>

    <button onclick="exportToCalendar()" id="t-export-btn"
            class="w-full bg-black text-white text-[13px] font-bold py-4 rounded-2xl active:scale-95 transition shadow-lg mb-8">
        تصدير للتقويم
    </button>

    <div class="mt-auto py-4 text-center border-t border-gray-100">
        <p class="text-[10px] text-gray-400 font-medium">
            © <span id="year"></span> <span id="t-rights">جميع الحقوق محفوظة</span> | <span class="text-gray-600 font-bold tracking-wide">Ali Al-Soudi</span>
        </p>
    </div>
</div>

<script>
    let currentLang = 'ar';
    document.getElementById('year').innerText = new Date().getFullYear();

    const i18n = {
        ar: {
            title: "متابع الشفتات",
            company: "شركة البوتاس العربية",
            selectShift: "اختر الوردية",
            pickMonth: "اختر الشهر",
            exportBtn: "تصدير للتقويم",
            rights: "جميع الحقوق محفوظة",
            days: ["أحد", "اثنين", "ثلاثاء", "أربعاء", "خميس", "جمعة", "سبت"],
            shifts: { M: "صباحي", A: "مسائي", N: "ليلي", O: "استراحة" }, // تم التعديل هنا
            groups: ["الوردية A", "الوردية B", "الوردية C", "الوردية D"]
        },
        en: {
            title: "Shift Tracker",
            company: "Arab Potash Company",
            selectShift: "Select Shift",
            pickMonth: "Pick Month",
            exportBtn: "Export Calendar",
            rights: "All Rights Reserved",
            days: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
            shifts: { M: "Morning", A: "After<br>Noon", N: "Night", O: "Off" },
            groups: ["Shift A", "Shift B", "Shift C", "Shift D"]
        }
    };

    const refDate = new Date(2025, 11, 18);
    const sequence = ['A','A','A','M','M','M','O','O','O','N','N','N'];
    const groupOffsets = {A:0, B:9, C:6, D:3}; 

    const monthPicker = document.getElementById('monthPicker');
    const shiftSelect = document.getElementById('shiftSelect');
    const calendarGrid = document.getElementById('calendarGrid');
    const weekDaysRow = document.getElementById('weekDaysRow');

    const now = new Date();
    monthPicker.value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;

    function toggleLang() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        document.documentElement.lang = currentLang;
        document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
        document.getElementById('langBtn').innerText = currentLang === 'ar' ? 'EN' : 'AR';
        updateUI();
        render();
    }

    function updateUI() {
        const lang = i18n[currentLang];
        document.getElementById('t-title').innerText = lang.title;
        document.getElementById('t-company').innerText = lang.company;
        document.getElementById('t-select-shift').innerText = lang.selectShift;
        document.getElementById('t-pick-month').innerText = lang.pickMonth;
        document.getElementById('t-export-btn').innerText = lang.exportBtn;
        document.getElementById('t-rights').innerText = lang.rights;

        const options = shiftSelect.options;
        for (let i = 0; i < options.length; i++) {
            options[i].text = lang.groups[i];
        }
        weekDaysRow.innerHTML = lang.days.map(d => `<div>${d}</div>`).join('');
    }

    function render() {
        const [y, m] = monthPicker.value.split('-').map(Number);
        const first = new Date(y, m - 1, 1);
        const daysCount = new Date(y, m, 0).getDate();
        const startDay = first.getDay();

        document.getElementById('calendarHeader').innerText =
            first.toLocaleString(currentLang === 'ar' ? 'ar-JO' : 'en-US', { month: 'long', year: 'numeric' });

        calendarGrid.innerHTML = '';
        for (let i = 0; i < startDay; i++) { calendarGrid.innerHTML += '<div></div>'; }

        for (let d = 1; d <= daysCount; d++) {
            const cur = new Date(y, m - 1, d);
            let idx = Math.floor((cur - refDate) / (86400000)) + groupOffsets[shiftSelect.value];
            idx = ((idx % 12) + 12) % 12;

            const t = sequence[idx];
            const cls = t==='M'?'shift-morning':t==='A'?'shift-afternoon':t==='N'?'shift-night':'shift-off';
            const label = i18n[currentLang].shifts[t];

            calendarGrid.innerHTML += `
            <div class="day-cell ${cls}">
                <div class="day-number">${d}</div>
                <div class="shift-label">${label}</div>
            </div>`;
        }
    }

    function exportToCalendar() {
        const [y, m] = monthPicker.value.split('-').map(Number);
        const daysCount = new Date(y, m, 0).getDate();
        let ics = "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Shifts//EN\n";

        for (let d = 1; d <= daysCount; d++) {
            const cur = new Date(y, m - 1, d);
            let idx = Math.floor((cur - refDate) / (86400000)) + groupOffsets[shiftSelect.value];
            idx = ((idx % 12) + 12) % 12;
            
            const type = sequence[idx];
            const label = i18n[currentLang].shifts[type].replace('<br>',' ');

            const dateStr = `${cur.getFullYear()}${String(cur.getMonth()+1).padStart(2,'0')}${String(cur.getDate()).padStart(2,'0')}`;
            const next = new Date(cur);
            next.setDate(cur.getDate() + 1);
            const nextDateStr = `${next.getFullYear()}${String(next.getMonth()+1).padStart(2,'0')}${String(next.getDate()).padStart(2,'0')}`;

            ics += `BEGIN:VEVENT\nSUMMARY:${label}\nDTSTART;VALUE=DATE:${dateStr}\nDTEND;VALUE=DATE:${nextDateStr}\nEND:VEVENT\n`;
        }
        ics += "END:VCALENDAR";

        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([ics], { type: 'text/calendar;charset=utf-8' }));
        a.download = `APC_Shifts_${m}_${y}.ics`;
        a.click();
    }

    [monthPicker, shiftSelect].forEach(e => e.addEventListener('change', render));
    updateUI();
    render();
</script>

</body>
</html>
