<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Shift Tracker - APC</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
body{
    font-family:'Inter',sans-serif;
    background:#ffffff;
}

.main-title {
    font-size: 26px;
    font-weight: 800;
    letter-spacing: -1px;
    color: #000;
    text-transform: uppercase;
    font-style: italic;
    line-height: 1;
}

.card{
    background:#ffffff;
    border-radius:14px;
    border:1px solid #e5e7eb;
}

.input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.input-wrapper::after {
    content: '▼';
    font-size: 8px;
    position: absolute;
    right: 12px;
    color: #9ca3af;
    pointer-events: none;
}

.control-input{
    width:100%;
    border-radius:12px;
    border: 1.5px solid #f3f4f6;
    background:#f9fafb;
    padding:10px 12px;
    font-size:12px;
    font-weight:700;
    appearance: none;
    -webkit-appearance: none;
    outline: none;
}

.day-cell{
    aspect-ratio:1/1;
    border-radius:6px;
    padding:4px 2px;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    align-items:center;
    font-weight:600;
    text-align:center;
}

.day-number{
    font-size:11px;
    font-weight:700;
    color:#111827;
}

.shift-label{
    font-size:8px;
    font-weight:700;
    line-height:1.1;
    text-transform:uppercase;
}

.shift-morning{ background:#dcfce7; color:#166534; }
.shift-afternoon{ background:#dbeafe; color:#1e40af; }
.shift-night{ background:#fef3c7; color:#92400e; }
.shift-off{ background:#fde8e8; color:#b91c1c; }

.control-label{
    font-size:9px;
    font-weight:800;
    color:#9ca3af;
    margin-bottom:4px;
    display:block;
    text-transform: uppercase;
}

.company-name {
    font-size: 10px;
    font-weight: 700;
    color: #4b5563;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 2px;
}
</style>
</head>

<body class="antialiased">

<div class="max-w-md mx-auto px-5 py-8 flex flex-col min-h-screen">

    <div class="mb-6">
        <div class="flex flex-col items-start border-l-4 border-black pl-4 py-1">
            <h1 class="main-title">Shift Tracker</h1>
            <p class="company-name mt-1">Arab Potash Company</p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-6">
        <div>
            <label class="control-label">Select Shift</label>
            <div class="input-wrapper">
                <select id="shiftSelect" class="control-input">
                    <option value="A">Shift A</option>
                    <option value="B">Shift B</option>
                    <option value="C">Shift C</option>
                    <option value="D">Shift D</option>
                </select>
            </div>
        </div>

        <div>
            <label class="control-label">Pick Month</label>
            <div class="input-wrapper">
                <input type="month" id="monthPicker" class="control-input">
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-6">
        <div id="calendarHeader" class="text-center py-3 font-bold text-sm border-b bg-gray-50/50 uppercase tracking-widest text-gray-700"></div>

        <div class="grid grid-cols-7 text-center text-[9px] font-black text-gray-400 py-2 border-b uppercase">
            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
        </div>

        <div id="calendarGrid" class="grid grid-cols-7 gap-[3px] p-2"></div>
    </div>

    <button onclick="exportToCalendar()"
            class="w-full bg-black text-white text-[11px] font-bold py-4 rounded-2xl tracking-[0.2em] active:scale-95 transition shadow-lg mb-8 uppercase">
        Export Calendar
    </button>

    <div class="mt-auto py-4 text-center">
        <p class="text-[10px] text-gray-400 font-medium">
            © <script>document.write(new Date().getFullYear())</script> All Rights Reserved | <span class="text-gray-600 font-bold tracking-wide">Ali Al-Soudi</span>
        </p>
    </div>

</div>

<script>
const refDate = new Date(2025,11,18);
const sequence = ['A','A','A','M','M','M','O','O','O','N','N','N'];
const groupOffsets = {A:0,B:3,C:6,D:9};
const shiftLabels = { M:'Morning', A:'After<br>Noon', N:'Night', O:'Off' };

const monthPicker = document.getElementById('monthPicker');
const shiftSelect = document.getElementById('shiftSelect');
const calendarGrid = document.getElementById('calendarGrid');

const now = new Date();
monthPicker.value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;

function render(){
    const [y,m] = monthPicker.value.split('-').map(Number);
    const first = new Date(y,m-1,1);
    const days = new Date(y,m,0).getDate();
    const start = first.getDay();

    document.getElementById('calendarHeader').innerText =
        first.toLocaleString('en-US',{month:'long',year:'numeric'});

    calendarGrid.innerHTML='';

    for(let i=0;i<start;i++){
        calendarGrid.innerHTML+='<div></div>';
    }

    for(let d=1;d<=days;d++){
        const cur = new Date(y,m-1,d);
        let idx = Math.floor((cur-refDate)/(86400000)) + groupOffsets[shiftSelect.value];
        idx = ((idx%12)+12)%12;

        const t = sequence[idx];
        const cls = t==='M'?'shift-morning':t==='A'?'shift-afternoon':t==='N'?'shift-night':'shift-off';

        calendarGrid.innerHTML += `
        <div class="day-cell ${cls}">
            <div class="day-number">${d}</div>
            <div class="shift-label">${shiftLabels[t]}</div>
        </div>`;
    }
}

function exportToCalendar(){
    const [y,m] = monthPicker.value.split('-').map(Number);
    const days = new Date(y,m,0).getDate();
    let ics = "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Shifts//EN\n";

    for(let d=1;d<=days;d++){
        const cur = new Date(y,m-1,d);
        let idx = Math.floor((cur-refDate)/(86400000)) + groupOffsets[shiftSelect.value];
        idx = ((idx%12)+12)%12;
        
        const type = sequence[idx];
        const label = (type === 'O') ? 'OFF' : shiftLabels[type].replace('<br>',' ');

        let timePoint;
        const dateStr = cur.toISOString().slice(0,10).replace(/-/g,'');

        // ضبط وقت البداية والنهاية ليكون نفس الموعد تماماً
        if (type === 'M') { // الصباحي 6:00
            timePoint = `${dateStr}T060000`;
        } else if (type === 'A') { // المسائي 2:00 (14:00)
            timePoint = `${dateStr}T140000`;
        } else if (type === 'N') { // الليلي 10:00 (22:00)
            timePoint = `${dateStr}T220000`;
        }

        if (type === 'O') { // العطلة تبقى يوم كامل
            const s = `;VALUE=DATE:${dateStr}`;
            const nextDay = new Date(cur);
            nextDay.setDate(cur.getDate() + 1);
            const e = `;VALUE=DATE:${nextDay.toISOString().slice(0,10).replace(/-/g,'')}`;
            ics += `BEGIN:VEVENT\nSUMMARY:${label}\nDTSTART${s}\nDTEND${e}\nEND:VEVENT\n`;
        } else {
            // للمناوبات: البداية والنهاية نفس الساعة
            ics += `BEGIN:VEVENT\nSUMMARY:${label}\nDTSTART:${timePoint}\nDTEND:${timePoint}\nEND:VEVENT\n`;
        }
    }
    ics += "END:VCALENDAR";

    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([ics],{type:'text/calendar'}));
    a.download = `APC_Shifts_${m}_${y}.ics`;
    a.click();
}

[monthPicker,shiftSelect].forEach(e=>e.addEventListener('change',render));
render();
</script>

</body>
</html>
